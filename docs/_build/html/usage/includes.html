
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Using includes &#8212; pytranscoder 2.2.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Using Mixins" href="mixins.html" />
    <link rel="prev" title="Running (Clustered)" href="running-clustered.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="using-includes">
<h1>Using includes<a class="headerlink" href="#using-includes" title="Permalink to this heading">¶</a></h1>
<p>This feature requires a deeper familiarity with the YAML format. Essentially, you can define a partial profile or a full one and later “include” it into another profile. This facilitates reuse of definitions and simpler profiles.
All options from all sections of the profile are combined.  If there is a conflict, the descendant one wins.
Profile sections input_options and output_options are combined.  So all included profile options are combined with the descendant.
Since the introduction of mixins you should only put general, non-encoding options in output_options.  Audio, video, and subtitle options have their own sections now (see Mixins before proceeding).
The rule is: input_options and output_options can be built-up via includes (inheritance), but mixins are replacements and the last most recent one wins.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Merge-style example</span>
<span class="c1">#</span>
<span class="nt">profiles</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># values universal to all my high-quality transcodes</span>
<span class="w">    </span><span class="nt">hq</span><span class="p">:</span>
<span class="w">      </span><span class="nt">output_options</span><span class="p">:</span><span class="w">  </span><span class="c1"># options using hyphens and separate lines are &quot;lists&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-crf</span><span class="nv"> </span><span class="s">18&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-preset</span><span class="nv"> </span><span class="s">slow&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-c:a</span><span class="nv"> </span><span class="s">copy&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-c:s</span><span class="nv"> </span><span class="s">copy&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-f</span><span class="nv"> </span><span class="s">matroska&quot;</span>
<span class="w">      </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">      </span><span class="nt">extension</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;.mkv&quot;</span>

<span class="w">    </span><span class="nt">hevc_cuda</span><span class="p">:</span>
<span class="w">      </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hq</span><span class="w">     </span><span class="c1"># pull in everything defined above in &quot;hq&quot;</span>
<span class="w">      </span><span class="nt">output_options</span><span class="p">:</span><span class="w"> </span><span class="c1"># combine these options with those from &quot;hq&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-c:v</span><span class="nv"> </span><span class="s">hevc_nvenc&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-profile:v</span><span class="nv"> </span><span class="s">main&quot;</span>
<span class="w">      </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">18</span><span class="w">    </span><span class="c1"># replace &quot;hq&quot; threshold value with 18</span>
</pre></div>
</div>
<p>The above example is equivalent to:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hevc_cuda</span><span class="p">:</span>
<span class="w">  </span><span class="nt">output_options</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-crf</span><span class="nv"> </span><span class="s">18&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-preset</span><span class="nv"> </span><span class="s">slow&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-c:a</span><span class="nv"> </span><span class="s">copy&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-c:s</span><span class="nv"> </span><span class="s">copy&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-f</span><span class="nv"> </span><span class="s">matroska&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-c:v</span><span class="nv"> </span><span class="s">hevc_nvenc&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-profile:v</span><span class="nv"> </span><span class="s">main&quot;</span>
<span class="w">  </span><span class="nt">threshold </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">18</span>
<span class="w">  </span><span class="nt">extension</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;.mkv&quot;</span>
</pre></div>
</div>
<p>The advantage is that now we have a base (parent) profile we can include into many others to avoid repetitive profile definitions.  And, if we decide to change our base threshold, for example, we only need to change it in the base (parent).</p>
<p>Note that the profiles “hq” and “hevc_cuda” were combined, and the value for threshold was overridden to 18.
Lets refer to the first (base) profile as the parent, and the second as the child. So a child profile can include one or more parent profiles.  All values in the child are retained. However, if input_options or output_options are lists instead of strings, the parent and child values will be combined.
Here is the same example slightly reformatted:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Replace-style example</span>
<span class="c1">#</span>
<span class="w">  </span><span class="nt">profiles</span><span class="p">:</span>
<span class="w">    </span><span class="nt">hq</span><span class="p">:</span>
<span class="w">      </span><span class="nt">output_options</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-crf</span><span class="nv"> </span><span class="s">18&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-preset</span><span class="nv"> </span><span class="s">slow&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-c:a</span><span class="nv"> </span><span class="s">copy&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-c:s</span><span class="nv"> </span><span class="s">copy&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-f</span><span class="nv"> </span><span class="s">matroska&quot;</span>
<span class="w">      </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">      </span><span class="nt">extension</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;.mkv&quot;</span>

<span class="w">    </span><span class="nt">hevc_cuda</span><span class="p">:</span>
<span class="w">      </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hq</span>
<span class="w">      </span><span class="nt">output_options</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-c:v</span><span class="nv"> </span><span class="s">hevc_nvenc&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-profile:v</span><span class="nv"> </span><span class="s">main&quot;</span>
<span class="w">      </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">18</span>
</pre></div>
</div>
<p>This will produce a bad profile. Now I need to mention a feature of YAML only used in the <strong>include</strong> examples - lists.  YAML-formatted data can be very complex but pytranscoder requirements are meager and simple.  But to support the include feature in both _replace_ and _merge_ modes I needed another way to express input and output options.
Note the difference in the Merge and Replace examples is that Merge uses hyphens and a separate line for the output_options sections.  In Replace, all the options are on a single line.  The former is an expression of a “list of arguments”.  The latter is just a “string of arguments” When a parent and child both have input_options or output_options that are lists, the two are combined.  If either is not a list (just a string), then the child wins and the parent version is ignored.
With this new information we can now see why the Replace example produces a bad profile.  It will look like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hevc_cuda</span><span class="p">:</span>
<span class="w">  </span><span class="nt">output_options</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-c:v</span><span class="nv"> </span><span class="s">hevc_nvenc&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-profile:v</span><span class="nv"> </span><span class="s">main&quot;</span>
<span class="w">  </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">18</span>
<span class="w">  </span><span class="nt">extension</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;.mkv&quot;</span>
</pre></div>
</div>
<p>Since _output_options_ is a simple string rather than list, pytranscoder doesn’t know how to merge them so it doesn’t try.  The child values always wins.  So this profile will produce undesirable results because the parent options weren’t merged.  Convert both back to lists and it will work again.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">pytranscoder</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../configuration/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/concurrency.html">Concurrency</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/cluster.html">Cluster Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/cluster.html#ssh">SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/cluster.html#pytranscoder-agent">Pytranscoder Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="running-local.html">Running (Local)</a></li>
<li class="toctree-l1"><a class="reference internal" href="running-clustered.html">Running (Clustered)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using includes</a></li>
<li class="toctree-l1"><a class="reference internal" href="mixins.html">Using Mixins</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="running-clustered.html" title="previous chapter">Running (Clustered)</a></li>
      <li>Next: <a href="mixins.html" title="next chapter">Using Mixins</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019-2023, Marshall L Smith Jr.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/usage/includes.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>